---
title: "HW5"
output: html_document
date: "2023-03-31"
---

```{r setup, include=FALSE}
library(tidyverse)
library(readr)
```

### QUESTION 1

#### (a)
```{r}
## fit a poisson log-link model
crab = read.table("HW5-crab.txt", header = TRUE)
M1 = glm(Sa ~ W, family=poisson(link=log), data=crab)
summary(M1)

# goodness of fit
res.pearson = residuals(M1, type="pearson")
G.stat = sum(res.pearson^2)
res.dev = residuals(M1, type="deviance")
D.stat = sum(res.dev^2)
1-pchisq(G.stat, df=173-2)
1-pchisq(D.stat, df=173-2)

```
**Goodness of fit:**

The Pearson's Chi-square test statistic is `r round(G.stat, 2)`, deviance test statistic is `r round(D.stat, 2)`. The p-values of both of them are less than 0.05 under 171 df, indicating the fit is not good here.

**Interpretation of the model:**

We fitted a poisson log linear model here where:

log(E(Y)) = β0 + β1·X

with Y=Sa (number of satellites), X=W (carapace width).

Here β0 = `r round(M1$coefficients[1], 2)`, β1 =  `r round(M1$coefficients[2], 2)`. Indicating that when the carapace width is 0, the expected number of satellites is `r round(exp(M1$coefficients[1]), 2)` . When there's one unit change in carapace width, the expected change in the number of satellites is `r round(exp(M1$coefficients[2]), 2)`.


#### (b)
```{r}
# fit again with 2 predictors
M2 = glm(Sa ~ W + Wt, family=poisson(link=log), data=crab)
summary(M2)

# goodness of fit
res.pearson2 = residuals(M2, type="pearson")
G.stat2 = sum(res.pearson2^2)
res.dev2 = residuals(M2, type="deviance")
D.stat2 = sum(res.dev2^2)
1-pchisq(G.stat2, df=173-3)
1-pchisq(D.stat2, df=173-3)

# compare 2 models
test.stat = M1$deviance - M2$deviance
df = 171-170
pv3 =  1-pchisq(test.stat, df = df)
pv3 # rej, choose larger model
```
The Pearson's Chi-square test statistic is `r round(G.stat2, 2)`, deviance test statistic is `r round(D.stat2, 2)`. The p-values of both of them are less than 0.05 under 170 df, indicating the fit is not good here. However, the p-value of the deviance test comparing the two models is less than 0.05 under 1 df, indicating that we should choose the larger model over the smaller one.


#### (c)
```{r}

```

### QUESTION 2

#### (a)
```{r}
# fit a poisson log-link model
fish = read.table("HW5-parasite.txt", header = TRUE)
fish = fish %>% 
  mutate(Area = as.factor(Area),
         Year = as.factor(Year))
M1.fish = glm(Intensity ~ Area + Year + Length, family=poisson(link=log), data=fish)
summary(M1.fish)
```

#### (b)
```{r}
# goodness of fit
res.pearson = residuals(M1.fish, type="pearson")
G.stat = sum(res.pearson^2)
res.dev = residuals(M1.fish, type="deviance")
D.stat = sum(res.dev^2)
pv1 = 1-pchisq(G.stat, df=1184)
pv2 = 1-pchisq(D.stat, df=1184)
pv1
pv2
```


